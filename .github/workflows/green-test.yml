# .github/workflows/green-test.yml
name: Green DevOps Measurement

on: [push]

jobs:
  build-and-measure:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # -----------------------------------------------------------------
      # STEP 1: Start the measurement
      - name: Start energy measurement
        uses: green-coding-solutions/eco-ci-energy-estimation@v4
        id: eco-ci-start
        with:
          # ✅ FIX: Add this required 'task' line
          task: start-measurement
      # -----------------------------------------------------------------

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          
      - name: Install Dependencies
        run: npm install

      - name: Run Tests
        run: npm test

      # -----------------------------------------------------------------
      # STEP 2: Get the measurement
      - name: Get measurement results
        uses: green-coding-solutions/eco-ci-energy-estimation@v4
        id: eco-ci-stop
        with:
          # ✅ FIX: Add this required 'task' line
          task: get-measurement
          # This links to the 'id' of the start step
          start-step-id: 'eco-ci-start'
          
      # -----------------------------------------------------------------
      # STEP 3: Display the results
      - name: Display results in Job Summary
        # ✅ FIX: This is a cleaner way to show results
        uses: green-coding-solutions/eco-ci-energy-estimation@v4
        with:
          # ✅ FIX: Tell the action to display
          task: display-results
          # This links to the 'id' of the 'get' step
          get-measurement-step-id: 'eco-ci-stop'
      # -----------------------------------------------------------------